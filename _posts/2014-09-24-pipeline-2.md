---
layout: post
title:  "A VTK pipeline primer (part 2)"
---

In my [last blog]({% post_url 2014-9-18-pipeline %}), I covered some of the
preliminaries for understanding how VTK's pipeline works. In this article, we
will see the pipeline in action and dissect the execution path to understand
the inner-workings of algorithms.

Let's start with a very simple pipeline.

![a pipeline](/assets/empty-pipeline.png)

We'll use the following code for the source and the algorithm.

{% highlight python %}
import vtk
from vtk.util.vtkAlgorithm import VTKPythonAlgorithmBase

class MySource(VTKPythonAlgorithmBase):
    def __init__(self):
        VTKPythonAlgorithmBase.__init__(self,
            nInputPorts=0,
            nOutputPorts=1, outputType='vtkPolyData')

    def RequestInformation(self, request, inInfo, outInfo):
        print "MySource RequestInformation:"
#        print outInfo.GetInformationObject(0)
        return 1

    def RequestUpdateExtent(self, request, inInfo, outInfo):
        print "MySource RequestUpdateExtent:"
#        print outInfo.GetInformationObject(0)
        return 1

    def RequestData(self, request, inInfo, outInfo):
        print "MySource RequestData:"
#        print outInfo.GetInformationObject(0)
        return 1

class MyFilter(VTKPythonAlgorithmBase):
    def __init__(self):
        VTKPythonAlgorithmBase.__init__(self,
            nInputPorts=1, inputType='vtkPolyData',
            nOutputPorts=1, outputType='vtkPolyData')

    def RequestInformation(self, request, inInfo, outInfo):
        print "MyFilter RequestInformation:"
#        print outInfo.GetInformationObject(0)
        return 1

    def RequestUpdateExtent(self, request, inInfo, outInfo):
        print "MyFilter RequestUpdateExtent:"
#        print outInfo.GetInformationObject(0)
        return 1

    def RequestData(self, request, inInfo, outInfo):
        print "MyFilter RequestData:"
#        print outInfo.GetInformationObject(0)
        return 1
{% endhighlight %}

Then we instantiate and execute this pipeline with the following code.

{% highlight python %}
s = MySource()

f = MyFilter()
f.SetInputConnection(s.GetOutputPort())

f.Update()
{% endhighlight %}

This will print the following.

{% highlight python %}
MySource RequestInformation:
MyFilter RequestInformation:
MyFilter RequestUpdateExtent:
MySource RequestUpdateExtent:
MySource RequestData:
MyFilter RequestData:
{% endhighlight %}

The most interesting thing here is the order of execution of the various
methods representing pipeline passes. Here are the order of the passes:

* RequestInformation
* RequestUpdateExtent
* RequestData

Furthermore, notice during `RequestInformation` and `RequestData`,
the method execution happens starting at the upstream algorithm (MySource)
and continues downstream. On the other hand, during `RequestUpdateExtent`,
execution starts downstream and continues upstream. Why this is so will
become more clear as we discuss each pass.

## RequestInformation

This is the meta-data pass. This is the pass where the sources (usually
readers) tell downstream algorithms about _what is available_ for them
to request. Some examples about meta-data include whole extent (see
[this blog]({% post_url 2014-09-13-h5py-reader %}) for example), timesteps
available, ensemble members available, data blocks available etc.
This meta-data usually originates in the readers (not necessarily required
to though) and is either copied downstream or modified. For example, a
subsetting filter can reduce the whole extent during its `RequestInformation`
telling downstream that it can access a smaller subset that what the reader
can provide. Or a filter that integrates a value over time may remove the
timesteps meta-data since its output represent the whole time range. We'll
see plenty of examples of this in upcoming blogs.

{% highlight sh %}
MySource RequestInformation:
vtkInformation (0x7fc6b3e1c5c0)
  DATA_OBJECT: vtkPolyData(0x7fc6b3e1e390)

MyFilter RequestInformation:
vtkInformation (0x7fc6b3e1c940)
  DATA_OBJECT: vtkPolyData(0x7fc6b3e1f1b0)

MyFilter RequestUpdateExtent:
vtkInformation (0x7fc6b3e1c940)
  DATA_OBJECT: vtkPolyData(0x7fc6b3e1f1b0)
  UPDATE_PIECE_NUMBER: 0
  UPDATE_NUMBER_OF_PIECES: 1
  UPDATE_NUMBER_OF_GHOST_LEVELS: 0
  UPDATE_EXTENT_INITIALIZED: 0

MySource RequestUpdateExtent:
vtkInformation (0x7fc6b3e1c5c0)
  DATA_OBJECT: vtkPolyData(0x7fc6b3e1e390)
  UPDATE_PIECE_NUMBER: 0
  UPDATE_NUMBER_OF_PIECES: 1
  UPDATE_NUMBER_OF_GHOST_LEVELS: 0
  UPDATE_EXTENT_INITIALIZED: 0

MySource RequestData:
vtkInformation (0x7fc6b3e1c5c0)
  DATA_OBJECT: vtkPolyData(0x7fc6b3e1e390)
  UPDATE_PIECE_NUMBER: 0
  UPDATE_NUMBER_OF_PIECES: 1
  UPDATE_NUMBER_OF_GHOST_LEVELS: 0
  UPDATE_EXTENT_INITIALIZED: 0

MyFilter RequestData:
vtkInformation (0x7fc6b3e1c940)
  DATA_OBJECT: vtkPolyData(0x7fc6b3e1f1b0)
  UPDATE_PIECE_NUMBER: 0
  UPDATE_NUMBER_OF_PIECES: 1
  UPDATE_NUMBER_OF_GHOST_LEVELS: 0
  UPDATE_EXTENT_INITIALIZED: 0
{% endhighlight %}
